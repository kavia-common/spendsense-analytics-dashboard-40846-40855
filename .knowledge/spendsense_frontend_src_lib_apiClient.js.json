{"is_source_file": true, "format": "JavaScript", "description": "This file defines an API client module for making HTTP requests with features such as retries, structured error handling, middleware hooks, and support for authorization tokens via Supabase. It includes utility functions for URL handling, query parameter management, and error parsing, along with a custom ApiError class and a factory function to create configured API clients.", "external_files": ["./logger", "./supabaseClient"], "external_methods": ["getLogger", "supabase.auth.getSession"], "published": ["createApiClient", "isApiError"], "classes": [{"name": "ApiError", "description": "A custom Error class that includes additional API error details such as status, code, details, requestId, and network error flag."}], "methods": [{"name": "createApiClient(env, options = {})", "description": "Creates and configures an API client with support for retries, timeouts, middleware, and token authentication.", "scope": "", "scopeKind": ""}, {"name": "isApiError(err)", "description": "Type guard function to check if an error is an instance of ApiError.", "scope": "", "scopeKind": ""}, {"name": "buildHttpError(res, text, url)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "computeBackoffMs(attemptIndex, baseMs, maxMs)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "constructor(params)", "scope": "ApiError", "scopeKind": "class", "description": "unavailable"}, {"name": "defaultTokenProvider()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "extractRequestId(res)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "getSupabaseAccessToken()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "isIdempotent(method)", "scope": "createApiClient", "scopeKind": "function", "description": "unavailable"}, {"name": "joinUrl(base, path)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "parseRetryAfterMs(res)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "request(method, path, reqOptions = {})", "scope": "createApiClient", "scopeKind": "function", "description": "unavailable"}, {"name": "safeJsonParse(text)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "shouldRetryResponse(method, res)", "scope": "createApiClient", "scopeKind": "function", "description": "unavailable"}, {"name": "sleep(ms)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "use(hooks = {})", "scope": "createApiClient", "scopeKind": "function", "description": "unavailable"}, {"name": "withQuery(url, query)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["getLogger()", "supabase.auth.getSession()"], "search-terms": ["apiClient", "structured error", "request retries", "middleware hooks", "Supabase token", "joinUrl", "withQuery", "ApiError", "createApiClient"], "state": 2, "file_id": 43, "knowledge_revision": 119, "git_revision": "", "ctags": [{"_type": "tag", "name": "Accept", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^      Accept: \"application\\/json, text\\/plain, *\\/*\",$/", "language": "JavaScript", "kind": "property", "scope": "createApiClient.request.headers", "scopeKind": "class"}, {"_type": "tag", "name": "ApiError", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^class ApiError extends Error {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "Content-Type", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^      \"Content-Type\": \"application\\/json\",$/", "language": "JavaScript", "kind": "property", "scope": "createApiClient.request.headers", "scopeKind": "class"}, {"_type": "tag", "name": "afterResponse", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    afterResponse: [],$/", "language": "JavaScript", "kind": "property", "scope": "createApiClient.middleware", "scopeKind": "class"}, {"_type": "tag", "name": "beforeRequest", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    beforeRequest: [],$/", "language": "JavaScript", "kind": "property", "scope": "createApiClient.middleware", "scopeKind": "class"}, {"_type": "tag", "name": "buildHttpError", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function buildHttpError(res, text, url) {$/", "language": "JavaScript", "kind": "function", "signature": "(res, text, url)"}, {"_type": "tag", "name": "code", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    code: undefined,$/", "language": "JavaScript", "kind": "property", "scope": "buildHttpError.shape", "scopeKind": "class"}, {"_type": "tag", "name": "computeBackoffMs", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function computeBackoffMs(attemptIndex, baseMs, maxMs) {$/", "language": "JavaScript", "kind": "function", "signature": "(attemptIndex, baseMs, maxMs)"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  constructor(params) {$/", "language": "JavaScript", "kind": "method", "signature": "(params)", "scope": "ApiError", "scopeKind": "class"}, {"_type": "tag", "name": "createApiClient", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^export function createApiClient(env, options = {}) {$/", "language": "JavaScript", "kind": "function", "signature": "(env, options = {})"}, {"_type": "tag", "name": "defaultTokenProvider", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^async function defaultTokenProvider() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "details", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    details: undefined,$/", "language": "JavaScript", "kind": "property", "scope": "buildHttpError.shape", "scopeKind": "class"}, {"_type": "tag", "name": "extractRequestId", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function extractRequestId(res) {$/", "language": "JavaScript", "kind": "function", "signature": "(res)"}, {"_type": "tag", "name": "getSupabaseAccessToken", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^async function getSupabaseAccessToken() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    const headers = {$/", "language": "JavaScript", "kind": "class", "scope": "createApiClient.request", "scopeKind": "class"}, {"_type": "tag", "name": "isApiError", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^export function isApiError(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "isIdempotent", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  function isIdempotent(method) {$/", "language": "JavaScript", "kind": "function", "signature": "(method)", "scope": "createApiClient", "scopeKind": "function"}, {"_type": "tag", "name": "joinUrl", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function joinUrl(base, path) {$/", "language": "JavaScript", "kind": "function", "signature": "(base, path)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^const logger = getLogger();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    message: `Request failed with status ${res.status}`,$/", "language": "JavaScript", "kind": "property", "scope": "buildHttpError.shape", "scopeKind": "class"}, {"_type": "tag", "name": "method", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    let apiReq = { method, url, headers, body, timeoutMs };$/", "language": "JavaScript", "kind": "field", "scope": "createApiClient.request.apiReq", "scopeKind": "class"}, {"_type": "tag", "name": "middleware", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  const middleware = {$/", "language": "JavaScript", "kind": "class", "scope": "createApiClient", "scopeKind": "class"}, {"_type": "tag", "name": "onError", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    onError: [],$/", "language": "JavaScript", "kind": "property", "scope": "createApiClient.middleware", "scopeKind": "class"}, {"_type": "tag", "name": "parseRetryAfterMs", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function parseRetryAfterMs(res) {$/", "language": "JavaScript", "kind": "function", "signature": "(res)"}, {"_type": "tag", "name": "request", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  async function request(method, path, reqOptions = {}) {$/", "language": "JavaScript", "kind": "function", "signature": "(method, path, reqOptions = {})", "scope": "createApiClient", "scopeKind": "function"}, {"_type": "tag", "name": "requestId", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    requestId,$/", "language": "JavaScript", "kind": "field", "scope": "buildHttpError.shape", "scopeKind": "class"}, {"_type": "tag", "name": "safeJsonParse", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function safeJsonParse(text) {$/", "language": "JavaScript", "kind": "function", "signature": "(text)"}, {"_type": "tag", "name": "shape", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  let shape = {$/", "language": "JavaScript", "kind": "class", "scope": "buildHttpError", "scopeKind": "class"}, {"_type": "tag", "name": "shouldRetryResponse", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  function shouldRetryResponse(method, res) {$/", "language": "JavaScript", "kind": "function", "signature": "(method, res)", "scope": "createApiClient", "scopeKind": "function"}, {"_type": "tag", "name": "sleep", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function sleep(ms) {$/", "language": "JavaScript", "kind": "function", "signature": "(ms)"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    status: res.status,$/", "language": "JavaScript", "kind": "property", "scope": "buildHttpError.shape", "scopeKind": "class"}, {"_type": "tag", "name": "use", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^    use,$/", "language": "JavaScript", "kind": "field", "scope": "createApiClient.api", "scopeKind": "class"}, {"_type": "tag", "name": "use", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^  function use(hooks = {}) {$/", "language": "JavaScript", "kind": "function", "signature": "(hooks = {})", "scope": "createApiClient", "scopeKind": "function"}, {"_type": "tag", "name": "withQuery", "path": "/home/kavia/workspace/code-generation/spendsense-analytics-dashboard-40846-40855/spendsense_frontend/src/lib/apiClient.js", "pattern": "/^function withQuery(url, query) {$/", "language": "JavaScript", "kind": "function", "signature": "(url, query)"}], "hash": "93a2c591e8eb25097d79dd4f58e9461b", "format-version": 4, "code-base-name": "spendsense_frontend", "filename": "spendsense_frontend/src/lib/apiClient.js", "fields": [{"name": "Accept: \"application\\/json, text\\/plain, *\\/*\",", "scope": "createApiClient.request.headers", "scopeKind": "class", "description": "unavailable"}, {"name": "\"Content-Type\": \"application\\/json\",", "scope": "createApiClient.request.headers", "scopeKind": "class", "description": "unavailable"}, {"name": "afterResponse: [],", "scope": "createApiClient.middleware", "scopeKind": "class", "description": "unavailable"}, {"name": "beforeRequest: [],", "scope": "createApiClient.middleware", "scopeKind": "class", "description": "unavailable"}, {"name": "code: undefined,", "scope": "buildHttpError.shape", "scopeKind": "class", "description": "unavailable"}, {"name": "details: undefined,", "scope": "buildHttpError.shape", "scopeKind": "class", "description": "unavailable"}, {"name": "message: `Request failed with status ${res.status}`,", "scope": "buildHttpError.shape", "scopeKind": "class", "description": "unavailable"}, {"name": "let apiReq = { method, url, headers, body, timeoutMs };", "scope": "createApiClient.request.apiReq", "scopeKind": "class", "description": "unavailable"}, {"name": "onError: [],", "scope": "createApiClient.middleware", "scopeKind": "class", "description": "unavailable"}, {"name": "requestId,", "scope": "buildHttpError.shape", "scopeKind": "class", "description": "unavailable"}, {"name": "status: res.status,", "scope": "buildHttpError.shape", "scopeKind": "class", "description": "unavailable"}, {"name": "use,", "scope": "createApiClient.api", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"119": ""}]}